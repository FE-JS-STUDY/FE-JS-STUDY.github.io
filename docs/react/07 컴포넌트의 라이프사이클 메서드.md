# 07 컴포넌트의 라이프사이클 메서드

### 7.2.6 getSnapshotBeforeUpdate 메서드

render에서 만들어진 결과물이 브라우저에 실제로 반영되기 직전에 호출되는 메서드이다. 주로 업데이트하기 직전의 값을 참고할 때 활용된다.

```javascript
getSnapshotBeforeUpdate(prevProps, prevState) {
    if (prevState.array !== this.state.array) {
        const { scrollTop, scrollHeight } = this.list
        return { scrollTop, scrollHeight };
    }
}
```

### 7.2.7 componentDidUpdate 메서드

`componentDidUpdate(prevProps, prevState, snapshot) { ... }`

리렌더링을 완료한 후 실행하는 메서드이다. prevProps와 prevState를 사용하여 컴포넌트가 이전에 가졌던 데이터에 접근할 수 있다. 또한 getSnapshotBeforeUpdate에서 반환한 값이 있다면 여기서 snapshot 값을 전달받을 수 있다.

### 7.2.8 componetWillUnmount 메서드

`componentWillUnmount() { ... }`

컴포넌트를 DOM에서 제거할 때 실행하는 메서드이다.

### 7.2.9 componentDidCatch 메서드

컴포넌트 렌더링 도중에 에러가 발생했을 때 애플리케이션이 먹통이 되지 않고 오류 UI를 보여줄 수 있게 해주는 메서드이다.

```javascript
compoentDidCatch(error, info) {
    this.setState({
        error: true
    });
    console.log({ error, info });
}
```

여기서 error는 파라미터에 어떤 에러가 발생했는지 알려주며, info 파라미터는 어디에 있는 코드에서 오류가 발생했는지에 대한 정보를 준다.

## 7.3 라이프사이클 메서드 사용하기

LifeCycleSample 컴포넌트 만들기 -> App에 렌더링하기 -> 버튼 누르고 콘솔 창 관찰하기

### 7.3.1 예제 컴포넌트 생성

```javascript
import { Component } from "react";

class LifeCycleSample extends Component {
  state = {
    number: 0,
    color: null,
  };

  myRef = null;

  constructor(props) {
    super(props);
    console.log("constructor");
  }

  static getDrivedStateFromProps(nextProps, prevState) {
    // 컴포넌트가 마운트, 업데이트될 때 실행
    console.log("getDerivedStateFromProps");
    if (nextProps.color !== prevState.color) {
      return { color: nextProps.color };
    }
    return null;
  }

  componentDidMount() {
    // 컴포넌트가 웹 브라우저에 렌더링될 때 실행
    consosle.log("componentDidMount");
  }

  shouldComponentUpdate(nextProps, nextState) {
    // 리렌더링 여부 결정
    console.log("shouldComponentUpdate", nextProps, nextState);
    return nextState.number % 10 !== 4; // 끝자리가 4이면 리렌더링 하지 않음
  }

  componentWillUnmount() {
    // 컴포넌트가 DOM에서 제거될 때 실행
    console.log("compoentWillUnmount");
  }

  handleClick = () => {
    this.setState({
      number: this.state.number + 1,
    });
  };

  getSnapshotBeforeUpdate(prevProps, prevState) {
    // 결과물이 실제로 브라우저에 반영되기 직전에 호출
    console.log("getSnapshotBeforeUpdate");
    if (prevProps.color !== this.props.color) {
      return this.myRef.style.color; // 이전의 컬러와 새롭게 props된 컬러가 다르면 값 리턴
    }
    return;
  }

  componentDidUpdate(prevProps, prevState, snapshot) {
    // 리렌더링 완료한 후 실행, prevProps와 prevState 통해 이전 데이터 접근
    console.log("componentDidUpdate", prevProps, prevState);
    if (snapshot) {
      console.log("업데이트되기 직전 색상: ", snapshot); // getSnapshotBeforeUpdate를 통해 snapshot 조회 가능
    }
  }

  render() {
    console.log("render");

    const style = {
      color: this.props.color,
    };

    return (
      <div>
        <h1 style={style} ref={(ref) => (this.myRef = ref)}>
          {this.state.number}
        </h1>
        <p>color: {this.state.color}</p>
        <button onClick={this.handleClick}>더하기</button>
      </div>
    );
  }
}

export default LifeCycleSample;
```

이 컴포넌트는 각 라이프사이클 메서드를 실행할 때마다 콘솔 디버거에 기록하고, 부모 컴포넌트에서 props로 색상을 받아 버튼을 누르면 state.number 값을 1씩 더한다.
